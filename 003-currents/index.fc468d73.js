function t(t){return t&&t.__esModule?t.default:t}var i={};i=p5;class s{constructor(s,e){this.nCollisions=0,this.pos=s,this.vCollide=new(t(i)).Vector(0,0),this.radius=e}resetCollisions(){this.vCollide=new(t(i)).Vector(0,0),this.nCollisions=0}}function e(t,i,s){let e=t.x-i.x,o=t.y-i.y;return e*e+o*o<s*s}class o{constructor(t,i,s){for(this.spec=t,this.motes=[],this.rng=i,this.flowField=s;this.motes.length<this.spec.numMotes;)this.addMote()}randomPos(){let s=this.spec;return new(t(i)).Vector(this.rng.uniform(0,s.xDim),this.rng.uniform(0,s.yDim))}inBounds(t){return t.x>=0&&t.x<=this.spec.xDim&&t.y>=0&&t.y<=this.spec.yDim}addMote(){let t=new s(this.randomPos(),this.spec.moteRadius);this.motes.push(t)}step(){for(;this.motes.length<this.spec.numMotes;)this.addMote();let s=this.flowField;for(let[s,o]of(this.motes.forEach(t=>t.resetCollisions()),function(t,i,s,o){if(s<=0||o<=0||s>o||o%s!=0)throw Error("invalid sector configuration");let n=[],r=o/s,h=Array(r*r).fill(null).map(()=>[]);return t.forEach(t=>{if(t.radius<0||!Number.isFinite(t.radius))throw Error("Mote has invalid radius");let{pos:i,radius:e}=t;if(i.x>=o||i.x<0||i.y>=o||i.y<0)throw Error("Mote out of bounds");let n=Math.floor(t.pos.x/s);h[Math.floor(t.pos.y/s)*r+n].push(t)}),h.forEach((t,s)=>{let o=[];o=1===r?[]:2===r?[s-r-1,s-r,s-1]:[s-r-1,s-r,s-r+1,s-1];for(let s=0;s<t.length;s++){let r=t[s];for(let o=s+1;o<t.length;o++){let s=t[o];e(r.pos,s.pos,r.radius+s.radius+i)&&n.push([r,s])}o.forEach(t=>{if(t>=0&&t<h.length){let s=h[t];for(let t=0;t<s.length;t++){let o=s[t];e(r.pos,o.pos,r.radius+o.radius+i)&&n.push([r,o])}}})}}),n}(this.motes,this.spec.moteInfluenceRadius,this.spec.sectorSize,Math.max(this.spec.xDim,this.spec.yDim)))){let e;let n=t(i).Vector.sub(s.pos,o.pos),r=n.mag()-s.radius-o.radius;e=r<0?.2:.2*(this.spec.moteInfluenceRadius-r)/this.spec.moteInfluenceRadius,n.setMag(e),s.vCollide.add(n),o.vCollide.sub(n),s.nCollisions++,o.nCollisions++}this.motes.forEach(t=>{let i=s.flow(t.pos);t.pos.add(i),t.pos.add(t.vCollide)}),this.motes=this.motes.filter(t=>this.inBounds(t.pos))}render(t){t.background(240,100,10),t.strokeWeight(2),t.noFill(),this.motes.forEach(i=>{let s=30+4*i.nCollisions;t.stroke(s,100,40+i.nCollisions,80),t.circle(i.pos.x,i.pos.y,i.radius)})}}function n(t,i,s,e,o){let n=function(t,i=null,s=null){return t=null!==s?Math.min(t,s):t,t=null!==i?Math.max(t,i):t}(t,i,s);return e+(o-e)/(s-i)*(n-i)}function r(t,i,s){return e=>{var o;let r=n(e=((e-i)%(o=s-i)+o)%o+i,i,s,0,t.length-1),h=Math.floor(r),l=t[h];return l+(t[h+1]-l)*(r-h)}}function h(s,e){let{numDisturbances:o,thetaVariance:n,defaultTheta:r}=e,h=[];for(let r=0;r<o;r++){let o=s.uniform(0,e.xDim),r=s.uniform(0,e.yDim),l=s.gauss(0,n),a=Math.abs(s.gauss(e.disturbanceRadiusMean,e.disturbanceRadiusVariance));h.push({pos:new(t(i)).Vector(o,r),theta:l,radius:a})}return{defaultTheta:r,disturbances:h}}r([1,.99179,.96729,.92692,.87132,.80141,.71835,.62349,.51839,.40478,.28453,.1596,.03205,-.09602,-.22252,-.34537,-.46254,-.57212,-.6723,-.76145,-.83809,-.90097,-.94906,-.98156,-.99795,-.99795,-.98156,-.94906,-.90097,-.83809,-.76145,-.6723,-.57212,-.46254,-.34537,-.22252,-.09602,.03205,.1596,.28453,.40478,.51839,.62349,.71835,.80141,.87132,.92692,.96729,.99179,1],0,2*Math.PI),r([0,.12788,.25365,.37527,.49072,.59811,.69568,.78183,.85514,.91441,.95867,.98718,.99949,.99538,.97493,.93847,.8866,.82017,.74028,.64823,.54553,.43388,.31511,.19116,.06407,-.06407,-.19116,-.31511,-.43388,-.54553,-.64823,-.74028,-.82017,-.8866,-.93847,-.97493,-.99538,-.99949,-.98718,-.95867,-.91441,-.85514,-.78183,-.69568,-.59811,-.49072,-.37527,-.25365,-.12788,-0],0,2*Math.PI);class l{constructor(t){this.xMin=0,this.xMax=1e3,this.yMin=0,this.yMax=1e3,this.spacing=10;let i=(this.xMax-this.xMin)/this.spacing,s=(this.yMax-this.yMin)/this.spacing;for(let{pos:e,theta:o,radius:r}of(this.fieldPoints=Array.from({length:i},()=>Array(s).fill(t.defaultTheta)),t.disturbances)){let t=e.x-r,h=e.x+r,l=e.y-r,a=e.y+r,u=Math.max(0,Math.floor(t/this.spacing)),c=Math.min(i,Math.ceil(h/this.spacing)),d=Math.max(0,Math.floor(l/this.spacing)),f=Math.min(s,Math.ceil(a/this.spacing));for(let t=u;t<c;t++){let i=this.spacing*t;for(let s=d;s<f;s++){let h=this.spacing*s,l=n(function(t,i,s,e){let o=t-s,n=i-e;return function(t,i=1e3,s=1e-14,e=1e-7){if(t<0)throw Error("Value must be non-negative.");let o=t;for(let n=0;n<i;n++){let i=o*o-t;if(Math.abs(i)<=e)break;let n=2*o;if(n<=s)break;o-=i/n}return o}(o*o+n*n)}(e.x,e.y,i,h),0,r,o,0);this.fieldPoints[t][s]+=l}}}}flow(s){let e=Math.floor(s.x/this.spacing),o=Math.floor(s.y/this.spacing),n=this.fieldPoints[e][o];return t(i).Vector.fromAngle(n)}}class a{constructor(){this.numMotes=6e3,this.xDim=1e3,this.yDim=1e3,this.moteRadius=8,this.moteInfluenceRadius=8,this.moteRenderScaling=.3,this.sectorSize=40,this.numDisturbances=30,this.thetaVariance=3.14,this.defaultTheta=0,this.disturbanceRadiusMean=100,this.disturbanceRadiusVariance=200}}function u(){return"0x"+Array(64).fill(0).map(()=>Math.floor(16*Math.random()).toString(16)).join("")}function c(t){let i=new d;return i.setSeed(t),i}class d{constructor(){this._state=new Uint16Array(4),this._dv=new DataView(this._state.buffer),this._nG=null,this._hNG=!1}setSeed(t){this._hNG=!1,this._nG=null;let i=~~((t.length-2)/2),s=[];for(let e=0;e<i;e++){let i=2+2*e;s.push(parseInt(t.slice(i,i+2),16))}let e=f(s,1690382925),o=f(s,72970470);this._dv.setUint32(0,e),this._dv.setUint32(4,o)}rnd(){let t=this._state,i=t[0],s=t[1],e=t[2],o=t[3],n=33103+32557*i|0,r=63335+32557*s+(19605*i+(n>>>16))|0,h=31614+32557*e+19605*s+(62509*i+(r>>>16))|0,l=5125+32557*o+(19605*e+62509*s)+(22609*i+(h>>>16));t[0]=n,t[1]=r,t[2]=h,t[3]=l;let a=(o<<21)+((o>>2^e)<<5)+((e>>2^s)>>11);return 23283064365386963e-26*((a>>>(o>>11)|a<<(31&-(o>>11)))>>>0)}uniform(t=1,i=null){return null===i&&([t,i]=[0,t]),this.rnd()*(i-t)+t}gauss(t=0,i=1){if(this._hNG){this._hNG=!1;var s=this._nG;return this._nG=null,t+i*s}var e=0,o=0,n=0;do n=(e=2*this.rnd()-1)*e+(o=2*this.rnd()-1)*o;while(n>=1||0===n)var r=Math.sqrt(-2*Math.log(n)/n);return this._nG=o*r,this._hNG=!0,t+e*r*i}odds(t){return this.uniform()<=t}choice(t){return t[Math.floor(this.uniform(0,t.length))]}weightedChoice(t){let i=t.map(([,t])=>t).reduce((t,i)=>t+i,0)*this.uniform(),s=0;for(let e=0;e<t.length;e++){let[o,n]=t[e];if((s+=n)>=i)return o}let[e]=t[t.length-1];return e}wc(t){return this.weightedChoice(t)}shuffle(t){let i=t.map(t=>[this.uniform(0,1),t]);return i.sort((t,i)=>t[0]<i[0]?-1:1),i.map(([,t])=>t)}winnow(t,i){let s=t.slice();for(;s.length>i;){let t=Math.floor(this.rnd()*s.length);s.splice(t,1)}return s}}function f(t,i=0){for(var s,e=t.length,o=i^e,n=0;e>=4;)s=(65535&(s=255&t[n]|(255&t[++n])<<8|(255&t[++n])<<16|(255&t[++n])<<24))*1540483477+(((s>>>16)*1540483477&65535)<<16),s^=s>>>24,o=(65535&o)*1540483477+(((o>>>16)*1540483477&65535)<<16)^(s=(65535&s)*1540483477+(((s>>>16)*1540483477&65535)<<16)),e-=4,++n;switch(e){case 3:o^=(255&t[n+2])<<16;case 2:o^=(255&t[n+1])<<8;case 1:o^=255&t[n],o=(65535&o)*1540483477+(((o>>>16)*1540483477&65535)<<16)}return o^=o>>>13,o=(65535&o)*1540483477+(((o>>>16)*1540483477&65535)<<16),(o^=o>>>15)>>>0}class m{constructor(t,i,s){this.p5=t,this.spec=i,this.r=t.windowWidth/i.xDim,this.zoom=s,this.zoomX=i.xDim/2,this.zoomY=i.yDim/2,t.pixelDensity(1),t.colorMode(t.HSB,360,100,100,100),this.c=t.createCanvas(t.windowWidth,t.windowHeight)}background(t,i,s){this.p5.background(t,i,s)}stroke(t,i,s,e){this.p5.stroke(t,i,s,e)}noStroke(){this.p5.noStroke()}circle(t,i,s){let e=(t-this.zoomX)*this.zoom*this.r+this.p5.windowWidth/2,o=(i-this.zoomY)*this.zoom*this.r+this.p5.windowHeight/2;this.p5.circle(e,o,2*s*this.r*this.zoom*this.spec.moteRenderScaling)}noFill(){this.p5.noFill()}strokeWeight(t){this.p5.strokeWeight(t)}}new(t(i))(function(t){let i,s,e;t.setup=()=>{let s=u();console.log(`seed: ${s}`);let n=c(s),r=new a,d=t.windowHeight,f=t.windowWidth;f>d?r.yDim=r.xDim*(d/f):r.xDim=r.yDim*(f/d);let p=new l(h(n,r));i=new m(t,r,1.1),e=new o(r,n,p)},t.mouseClicked=()=>{let t=c(u()),i=new l(h(t,s));e=new o(s,t,i)},t.draw=()=>{e.render(i),e.step()}});
//# sourceMappingURL=index.fc468d73.js.map
