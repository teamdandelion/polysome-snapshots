function t(t){return t&&t.__esModule?t.default:t}var s={};s=p5;class i{constructor(i,e){this.alive=!0,this.closestBoundary=1/0,this.nCollisions=0,this.pos=i,this.vCollide=new(t(s)).Vector(0,0),this.radius=e}resetCollisions(){this.vCollide=new(t(s)).Vector(0,0),this.closestBoundary=1/0,this.nCollisions=0}collide(i,e){let n=t(s).Vector.sub(this.pos,i.pos),r=n.mag()-this.radius-i.radius;this.vCollide.add(n.copy().setMag(r<0?.2:.2*(e-r)/e)),this.closestBoundary=Math.min(this.closestBoundary,r),this.nCollisions++}render(t){let s=30+4*this.nCollisions;t.strokeWeight(2),t.stroke(s,100,40+this.nCollisions,80),t.noFill(),t.circle(this.pos.x,this.pos.y,this.radius)}}function e(t,s,i){let e=t.x-s.x,n=t.y-s.y;return e*e+n*n<i*i}class n{constructor(t,s,i){for(this.spec=t,this.motes=[],this.rng=s,this.flowField=i;this.motes.length<this.spec.numMotes;)this.addMote(!1)}randomPos(i){let e=2*this.rng.rnd()*Math.PI,n=i?1:this.rng.rnd();return t(s).Vector.fromAngle(e,300*Math.sqrt(n)).add(500,500)}inBounds(t){return t.x>=this.spec.xMin&&t.x<=this.spec.xMax&&t.y>=this.spec.yMin&&t.y<=this.spec.yMax}addMote(t){let s=new i(this.randomPos(t),this.spec.moteRadius);this.motes.push(s)}step(){for(;this.motes.length<this.spec.numMotes;)this.addMote(!1);let t=this.flowField;for(let[t,s]of(this.motes.forEach(t=>t.resetCollisions()),function(t,s,i=50,n=1e3){if(i<=0||n<=0||i>n||n%i!=0)throw Error("invalid sector configuration");let r=[],h=n/i,o=Array(h*h).fill(null).map(()=>[]);return t.forEach(t=>{if(t.radius<0||!Number.isFinite(t.radius))throw Error("Mote has invalid radius");let{pos:s,radius:e}=t;if(s.x>=n||s.x<0||s.y>=n||s.y<0)throw Error("Mote out of bounds");let r=Math.floor(t.pos.x/i);o[Math.floor(t.pos.y/i)*h+r].push(t)}),o.forEach((t,i)=>{let n=[];n=1===h?[]:2===h?[i-h-1,i-h,i-1]:[i-h-1,i-h,i-h+1,i-1];for(let i=0;i<t.length;i++){let h=t[i];for(let n=i+1;n<t.length;n++){let i=t[n];e(h.pos,i.pos,h.radius+i.radius+s)&&r.push([h,i])}n.forEach(t=>{if(t>=0&&t<o.length){let i=o[t];for(let t=0;t<i.length;t++){let n=i[t];e(h.pos,n.pos,h.radius+n.radius+s)&&r.push([h,n])}}})}}),r}(this.motes,this.spec.moteInfluenceRadius,this.spec.sectorSize)))t.collide(s,this.spec.moteInfluenceRadius),s.collide(t,this.spec.moteInfluenceRadius);this.motes.forEach(s=>{let i=t.flow(s.pos);s.pos.add(i),s.pos.add(s.vCollide)}),this.motes=this.motes.filter(t=>this.inBounds(t.pos)&&t.alive)}render(t){t.background(240,100,10),this.motes.forEach(s=>s.render(t))}}function r(t,s,i,e,n){let r=function(t,s=null,i=null){return t=null!==i?Math.min(t,i):t,t=null!==s?Math.max(t,s):t}(t,s,i);return e+(n-e)/(i-s)*(r-s)}function h(t,s,i){return e=>{var n;let h=r(e=((e-s)%(n=i-s)+n)%n+s,s,i,0,t.length-1),o=Math.floor(h),l=t[o];return l+(t[o+1]-l)*(h-o)}}function o(i,e){let{numDisturbances:n,thetaVariance:r,defaultTheta:h}=e,o=[];for(let h=0;h<n;h++){let n=i.uniform(e.xMin,e.xMax),h=i.uniform(e.yMin,e.yMax),l=i.gauss(0,r),a=Math.abs(i.gauss(e.disturbanceRadiusMean,e.disturbanceRadiusVariance));o.push({pos:new(t(s)).Vector(n,h),theta:l,radius:a})}return{defaultTheta:h,disturbances:o}}h([1,.99179,.96729,.92692,.87132,.80141,.71835,.62349,.51839,.40478,.28453,.1596,.03205,-.09602,-.22252,-.34537,-.46254,-.57212,-.6723,-.76145,-.83809,-.90097,-.94906,-.98156,-.99795,-.99795,-.98156,-.94906,-.90097,-.83809,-.76145,-.6723,-.57212,-.46254,-.34537,-.22252,-.09602,.03205,.1596,.28453,.40478,.51839,.62349,.71835,.80141,.87132,.92692,.96729,.99179,1],0,2*Math.PI),h([0,.12788,.25365,.37527,.49072,.59811,.69568,.78183,.85514,.91441,.95867,.98718,.99949,.99538,.97493,.93847,.8866,.82017,.74028,.64823,.54553,.43388,.31511,.19116,.06407,-.06407,-.19116,-.31511,-.43388,-.54553,-.64823,-.74028,-.82017,-.8866,-.93847,-.97493,-.99538,-.99949,-.98718,-.95867,-.91441,-.85514,-.78183,-.69568,-.59811,-.49072,-.37527,-.25365,-.12788,-0],0,2*Math.PI);class l{constructor(t){this.xMin=0,this.xMax=1e3,this.yMin=0,this.yMax=1e3,this.spacing=10;let s=(this.xMax-this.xMin)/this.spacing,i=(this.yMax-this.yMin)/this.spacing;for(let{pos:e,theta:n,radius:h}of(this.fieldPoints=Array.from({length:s},()=>Array(i).fill(t.defaultTheta)),t.disturbances)){let t=e.x-h,o=e.x+h,l=e.y-h,a=e.y+h,u=Math.max(0,Math.floor(t/this.spacing)),d=Math.min(s,Math.ceil(o/this.spacing)),c=Math.max(0,Math.floor(l/this.spacing)),f=Math.min(i,Math.ceil(a/this.spacing));for(let t=u;t<d;t++){let s=this.spacing*t;for(let i=c;i<f;i++){let o=this.spacing*i,l=r(function(t,s,i,e){let n=t-i,r=s-e;return function(t,s=1e3,i=1e-14,e=1e-7){if(t<0)throw Error("Value must be non-negative.");let n=t;for(let r=0;r<s;r++){let s=n*n-t;if(Math.abs(s)<=e)break;let r=2*n;if(r<=i)break;n-=s/r}return n}(n*n+r*r)}(e.x,e.y,s,o),0,h,n,0);this.fieldPoints[t][i]+=l}}}}flow(i){let e=Math.floor(i.x/this.spacing),n=Math.floor(i.y/this.spacing),r=this.fieldPoints[e][n];return t(s).Vector.fromAngle(r)}}class a{constructor(){this.numMotes=4e3,this.xMin=0,this.xMax=1e3,this.yMin=0,this.yMax=1e3,this.moteRadius=8,this.moteInfluenceRadius=8,this.sectorSize=100,this.numDisturbances=30,this.thetaVariance=3.14,this.defaultTheta=0,this.disturbanceRadiusMean=100,this.disturbanceRadiusVariance=200}}function u(){return"0x"+Array(64).fill(0).map(()=>Math.floor(16*Math.random()).toString(16)).join("")}function d(t){let s=new c;return s.setSeed(t),s}class c{constructor(){this._state=new Uint16Array(4),this._dv=new DataView(this._state.buffer),this._nG=null,this._hNG=!1}setSeed(t){this._hNG=!1,this._nG=null;let s=~~((t.length-2)/2),i=[];for(let e=0;e<s;e++){let s=2+2*e;i.push(parseInt(t.slice(s,s+2),16))}let e=f(i,1690382925),n=f(i,72970470);this._dv.setUint32(0,e),this._dv.setUint32(4,n)}rnd(){let t=this._state,s=t[0],i=t[1],e=t[2],n=t[3],r=33103+32557*s|0,h=63335+32557*i+(19605*s+(r>>>16))|0,o=31614+32557*e+19605*i+(62509*s+(h>>>16))|0,l=5125+32557*n+(19605*e+62509*i)+(22609*s+(o>>>16));t[0]=r,t[1]=h,t[2]=o,t[3]=l;let a=(n<<21)+((n>>2^e)<<5)+((e>>2^i)>>11);return 23283064365386963e-26*((a>>>(n>>11)|a<<(31&-(n>>11)))>>>0)}uniform(t=1,s=null){return null===s&&([t,s]=[0,t]),this.rnd()*(s-t)+t}gauss(t=0,s=1){if(this._hNG){this._hNG=!1;var i=this._nG;return this._nG=null,t+s*i}var e=0,n=0,r=0;do r=(e=2*this.rnd()-1)*e+(n=2*this.rnd()-1)*n;while(r>=1||0===r)var h=Math.sqrt(-2*Math.log(r)/r);return this._nG=n*h,this._hNG=!0,t+e*h*s}odds(t){return this.uniform()<=t}choice(t){return t[Math.floor(this.uniform(0,t.length))]}weightedChoice(t){let s=t.map(([,t])=>t).reduce((t,s)=>t+s,0)*this.uniform(),i=0;for(let e=0;e<t.length;e++){let[n,r]=t[e];if((i+=r)>=s)return n}let[e]=t[t.length-1];return e}wc(t){return this.weightedChoice(t)}shuffle(t){let s=t.map(t=>[this.uniform(0,1),t]);return s.sort((t,s)=>t[0]<s[0]?-1:1),s.map(([,t])=>t)}winnow(t,s){let i=t.slice();for(;i.length>s;){let t=Math.floor(this.rnd()*i.length);i.splice(t,1)}return i}}function f(t,s=0){for(var i,e=t.length,n=s^e,r=0;e>=4;)i=(65535&(i=255&t[r]|(255&t[++r])<<8|(255&t[++r])<<16|(255&t[++r])<<24))*1540483477+(((i>>>16)*1540483477&65535)<<16),i^=i>>>24,n=(65535&n)*1540483477+(((n>>>16)*1540483477&65535)<<16)^(i=(65535&i)*1540483477+(((i>>>16)*1540483477&65535)<<16)),e-=4,++r;switch(e){case 3:n^=(255&t[r+2])<<16;case 2:n^=(255&t[r+1])<<8;case 1:n^=255&t[r],n=(65535&n)*1540483477+(((n>>>16)*1540483477&65535)<<16)}return n^=n>>>13,n=(65535&n)*1540483477+(((n>>>16)*1540483477&65535)<<16),(n^=n>>>15)>>>0}class p{constructor(t,s){this.p5=t,this.dd=s,this.pd=Math.min(t.windowWidth,t.windowHeight),this.r=this.pd/this.dd,t.pixelDensity(1),t.colorMode(t.HSB,360,100,100,100),this.c=t.createCanvas(this.pd,this.pd)}resize(){this.pd=Math.min(this.p5.windowWidth,this.p5.windowHeight),this.p5.resizeCanvas(this.pd,this.pd),this.r=this.pd/this.dd}background(t,s,i){this.p5.background(t,s,i)}stroke(t,s,i,e){this.p5.stroke(t,s,i,e)}noStroke(){this.p5.noStroke()}circle(t,s,i){this.p5.circle(t*this.r,s*this.r,2*i*this.r)}noFill(){this.p5.noFill()}strokeWeight(t){this.p5.strokeWeight(t)}}new(t(s))(function(t){let s,i,e;t.setup=()=>{let i=d(u()),r=new a,h=new l(o(i,r));s=new p(t,1e3),e=new n(r,i,h),t.colorMode(t.HSB,360,100,100,100)},t.windowResized=()=>{let s=Math.min(t.windowWidth,t.windowHeight);t.resizeCanvas(s,s)},t.mouseClicked=()=>{let t=d(u()),s=new l(o(t,i));e=new n(i,t,s)},t.draw=()=>{e.render(s),e.step()}});
//# sourceMappingURL=index.613998b6.js.map
